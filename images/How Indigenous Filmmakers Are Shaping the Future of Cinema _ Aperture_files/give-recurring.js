var Give_Recurring_Vars;jQuery(document).ready(function($){var doc=$(document);var Give_Recurring={init:function(){doc.on('give_donation_value_updated',function(e,parent_form,amount){if(!parent_form){parent_form=$(this).closest('form.give-form');}
var give_total=('undefined'===typeof amount)?parent_form.find('input[name="give-amount"]').val():amount,price_id=parent_form.find('input[name="give-price-id"]').val(),give_is_donation_recurring=parent_form.find('input[name="_give_is_donation_recurring"]').data('_give_recurring'),give_is_price_option=parent_form.find('input[name="_give_is_donation_recurring"]').data('_give_price_option');if('yes_donor'===give_is_donation_recurring||'set'===give_is_price_option){return false;}
Give_Recurring.notifyUserOnLevels(parent_form,give_total,price_id);});doc.on('give_gateway_loaded',function(e,response,form_id){var form=$(e.currentTarget.activeElement).closest('form.give-form');if(0===form.length){form=$('#'+form_id);}
var amount=form.find('input[name="give-amount"]').val(),price_id=form.find('input[name="give-price-id"]').val(),give_is_donation_recurring=form.find('input[name="_give_is_donation_recurring"]').data('_give_recurring'),give_is_price_option=form.find('input[name="_give_is_donation_recurring"]').data('_give_price_option');if('yes_donor'===give_is_donation_recurring||'set'===give_is_price_option){var recurring_period_label=form.find('.give-recurring-period');Give_Recurring.fetchRecurringPeriodText(recurring_period_label);return false;}
var decimal=Give.form.fn.getInfo('decimal_separator',form);amount=Give.fn.unFormatCurrency(amount,decimal);Give_Recurring.notifyUserOnLevels(form,amount,price_id);});Give_Recurring.confirm_subscription_cancellation();Give_Recurring.conditional_account_creation();$('.give-recurring-period').on('click',function(){var $this=$(this),form=$this.closest('form.give-form');if($this.is(':checked')){Give_Recurring.fetchRecurringPeriodText($this);}else{form.find('#give-recurring-modal-period-wrap').hide();form.find('#give-recurring-modal-period').html('');}});$('.give-recurring-donors-choice-period').on('change',function(){Give_Recurring.fetchRecurringPeriodText($(this));});doc.on('give_gateway_loaded',this.conditionalPeriodDropdown);doc.on('blur','.give-donation-amount .give-recurring-text-input',this.edit_renewal_amount);Give_Recurring.conditionalPeriodDropdown();Give_Recurring.changeGiveIsDonationRecurring();Give_Recurring.update_payment_method();},displayModalLabel:function(label,form){if(label!=="once"&&label!==""){form.find('#give-recurring-modal-period-wrap').show();form.find('#give-recurring-modal-period').html(label.charAt(0).toUpperCase()+label.slice(1));}else if(label==="once"){form.find('#give-recurring-modal-period-wrap').hide();form.find('#give-recurring-modal-period').html('');}},fetchRecurringPeriodText:function($this){var recurringPeriod=$this.data('period');var recurringPeriodLabel=$this.data('period-label');var form=$this.closest('form.give-form');var currentRecurringPeriod=form.find('.give-recurring-donors-choice-period').val();var prettyPeriods=Give_Recurring_Vars.pretty_periods;var isRecurringOpted=form.find('.give-recurring-period:checked').val();if($this.is('select')){recurringPeriodLabel=$this.closest('div.give-recurring-donors-choice').find('.give-recurring-period').data('period-label');recurringPeriod=$this.closest('div.give-recurring-donors-choice').find('.give-recurring-period').data('period');}
if(currentRecurringPeriod){recurringPeriodLabel=recurringPeriodLabel.replace(new RegExp(recurringPeriod,'g'),currentRecurringPeriod);recurringPeriodLabel=recurringPeriodLabel.replace(new RegExp(prettyPeriods[recurringPeriod],'g'),prettyPeriods[currentRecurringPeriod]);}
if('on'===isRecurringOpted){Give_Recurring.displayModalLabel(recurringPeriodLabel,form);}else{form.find('#give-recurring-modal-period-wrap').hide();form.find('#give-recurring-modal-period').html('');}},notifyUserOnLevels:function(form,amount,price_id){var data=JSON.parse(form.find('input[name="give_recurring_donation_details"]').val());if(false===data.is_recurring||'yes_donor'===data.give_recurring_option){return false;}
var multi_level_message=data.multi[price_id].give_recurring_pretty_text,multi_level_lower_message=multi_level_message.toLowerCase();amount=Give.fn.formatCurrency(amount,{currency:Give.form.fn.getInfo('currency_code',form),symbol:Give.form.fn.getInfo('currency_symbol',form),position:Give.form.fn.getInfo('currency_position',form)},form);var multi_level_message_html=Give_Recurring_Vars.multi_level_message_pre_text+' <span class="amount">'+amount+'</span> '+multi_level_lower_message+'.';form.find('.give-recurring-multi-level-message').html(multi_level_message_html);if('once'!==multi_level_lower_message){form.find('#_give_is_donation_recurring').val(1);}else{form.find('#_give_is_donation_recurring').val(0);}
Give_Recurring.displayModalLabel(multi_level_message,form);Give_Recurring.register_checkbox(form);},changeGiveIsDonationRecurring:function(){$('.give-form').on('change','.give-recurring-donors-choice',function(){var give_is_donation_recurring='0';var recurring_period=$(this).find('.give-recurring-period:checked').val();if('undefined'!==typeof(recurring_period)&&'on'===recurring_period){give_is_donation_recurring=1;}
var form=$(this).closest('form');form.find('._give_is_donation_recurring').val(give_is_donation_recurring);Give_Recurring.register_checkbox(form);});},conditional_account_creation:function(){if(Give_Recurring_Vars.email_access){return false;}
doc.on('give_gateway_loaded',function(ev,response,form_id){Give_Recurring.register_checkbox($('form#'+form_id));});$('form[id^=give-form].give-recurring-form').each(function(){Give_Recurring.register_checkbox($(this));});$(document).ajaxComplete(function(event,xhr,settings){var get_action=Give_Recurring.get_parameter('action',settings.data);if('give_cancel_login'===get_action){var form_id=Give_Recurring.get_parameter('form_id',settings.data);Give_Recurring.register_checkbox($('form#give-form-'+form_id));}});},get_parameter:function(parameter,data){if(!parameter){return false;}
if(!data){data=window.location.href;}
var parameter=parameter.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var expr=parameter+"=([^&#]*)";var regex=new RegExp(expr);var results=regex.exec(data);if(null!==results){return results[1];}else{return false;}},register_checkbox:function(form){if(Give_Recurring_Vars.email_access){return false;}
var recurring_logged=form.find('.give-logged-in-only').val();if('undefined'!==typeof(recurring_logged)&&1===parseInt(recurring_logged)){var is_recurring=form.find('._give_is_donation_recurring').val();if('undefined'!==typeof(is_recurring)&&1===parseInt(is_recurring)){Give_Recurring.disable_register_checkbox(form);}else{Give_Recurring.enable_register_checkbox(form);}}},enable_register_checkbox:function(form){var create_account_html=form.find('[name="give_create_account"]');create_account_html.removeClass('give-disabled');create_account_html.closest('span').removeClass('hint--top hint--bounce');},disable_register_checkbox:function(form){var create_account_html=form.find('[name="give_create_account"]');create_account_html.attr('checked',true);create_account_html.addClass('give-disabled');create_account_html.closest('span').addClass('hint--top hint--bounce');},confirm_subscription_cancellation:function(){$('.give-cancel-subscription').on('click touchend',function(){var response=confirm(Give_Recurring_Vars.messages.confirm_cancel);if(response!==true){return false;}});},conditionalPeriodDropdown:function(response){$('.give-gateway-option-selected').each(function(){var $form=$(this).parents('.give-form'),gateway=$(this).find('input').val(),period_select=$form.find('.give-recurring-donors-choice-period'),period=period_select.val(),day_option=$form.find('.give-recurring-donors-choice-period option[value="day"]');if('authorize'===gateway||'razorpay'===gateway){if('day'!==period){return;}
day_option.prop('disabled',true).next().attr('selected','selected');if('undefined'!==typeof response){alert(Give_Recurring_Vars.messages.daily_forbidden);}}else{day_option.prop('disabled',false);}});},update_payment_method:function(){$('form[name="give-recurring-form"]').submit(function(e){e.preventDefault();var this_form=$(this),update_button=this_form.find('#give-recurring-update-submit'),loading_animation=this_form.find('input[type="submit"].give-submit + .give-loading-animation'),give_payment_update_form=this_form.get(0),complete_purchase_val=this_form.find('#give-recurring-update-submit').val();loading_animation.fadeIn();if(typeof give_payment_update_form.checkValidity==='function'&&give_payment_update_form.checkValidity()===false){loading_animation.fadeOut();if((navigator.userAgent.indexOf('Safari')!==-1&&navigator.userAgent.indexOf('Chrome')===-1)===false){return;}}
update_button.val(give_global_vars.purchase_loading);update_button.attr('disabled','disabled');$.ajax({type:'POST',url:this_form.attr('action'),data:this_form.serialize(),success:function(data){loading_animation.fadeOut();this_form.find('.give_errors').remove();update_button.val(complete_purchase_val);update_button.prop('disabled',false);window.location.href=data;}});});},edit_renewal_amount:function(e,$parent_form){var parent_form=('undefined'!==typeof $parent_form)?$parent_form:$(this).closest('form'),this_value=$(this).val(),decimal_separator=Give.form.fn.getInfo('decimal_separator',parent_form),value_min=Give.form.fn.getMinimumAmount(parent_form),value_max=Give.form.fn.getMaximumAmount(parent_form),value_now=(this_value===0||''===this_value)?value_min:Give.fn.unFormatCurrency(this_value,decimal_separator),formatted_total=Give.form.fn.formatAmount(value_now,parent_form,{});$(this).val(formatted_total);if(!Give_Recurring.isValidRenewalAmount(parent_form)){$(this).addClass('give-invalid-amount');Give.form.fn.disable(parent_form,true);var invalid_minimum_notice=parent_form.find('.give-invalid-minimum'),invalid_maximum_notice=parent_form.find('.give-invalid-maximum');if(0===invalid_minimum_notice.length&&value_now<value_min){Give.notice.fn.renderNotice('bad_minimum',parent_form);}else if(value_now>=value_min){invalid_minimum_notice.slideUp(300,function(){$(this).remove();});}
if(0===invalid_maximum_notice.length&&value_now>value_max){Give.notice.fn.renderNotice('bad_maximum',parent_form);}else if(value_now<=value_max){invalid_maximum_notice.slideUp(300,function(){$(this).remove();});}}else{$(this).removeClass('give-invalid-amount');parent_form.find('.give-invalid-minimum, .give-invalid-maximum').slideUp(300,function(){$(this).remove();});Give.form.fn.disable(parent_form,false);}},isValidRenewalAmount:function($form){if($form.find('input[name="give-form-minimum"]').length<=0){return true;}
var min_amount=Give.form.fn.getMinimumAmount($form),max_amount=Give.form.fn.getMaximumAmount($form),amount=Give.form.fn.getAmount($form);if(0===amount){return false;}
return(((-1<amount)&&amount>=min_amount&&amount<=max_amount));}};Give_Recurring.init();});